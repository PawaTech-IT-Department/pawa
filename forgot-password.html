<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forgot Password</title>
  <link rel="stylesheet" href="/styles/login.css" />
</head>
<body>
  <div class="card-container">
    <div class="card">
      <div class="card-face card-face-front">
        <div>
          <h2 class="form-title">Forgot Password</h2>
          <form id="forgotPasswordForm">
            <div class="form-group">
              <input type="email" id="forgotEmail" name="email" placeholder="Enter your email address" required />
              <i class="bx bxs-envelope"></i>
            </div>
            <button type="submit" class="submit-btn">Send Reset Link</button>
          </form>
          <p class="switch-form-text">
            Remembered? <a href="login.html">Back to Login</a>
          </p>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.getElementById('forgotPasswordForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('forgotEmail').value;
      try {
        const btn = this.querySelector('button[type="submit"]');
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Sending...';
        const response = await fetch('/api/users/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await response.json();
        if (data.success) {
          alert('A password reset link has been sent to your email.');
        } else {
          throw new Error(data.error || data.message || 'Failed to send reset link');
        }
        btn.disabled = false;
        btn.innerHTML = originalText;
      } catch (err) {
        alert(err.message);
        this.querySelector('button[type="submit"]').disabled = false;
        this.querySelector('button[type="submit"]').innerHTML = 'Send Reset Link';
      }
    });
    function alert(message) {
      const existingAlert = document.getElementById("customAlert");
      if (existingAlert) {
        existingAlert.remove();
      }
      const alertBox = document.createElement("div");
      alertBox.id = "customAlert";
      alertBox.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #333;
        color: white;
        padding: 20px 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        z-index: 1000;
        font-size: 18px;
        text-align: center;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      `;
      alertBox.textContent = message;
      document.body.appendChild(alertBox);
      setTimeout(() => { alertBox.style.opacity = "1"; }, 10);
      setTimeout(() => {
        alertBox.style.opacity = "0";
        alertBox.addEventListener(
          "transitionend",
          () => { alertBox.remove(); },
          { once: true }
        );
      }, 3000);
    }
  </script>
</body>
</html>
